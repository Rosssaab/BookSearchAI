{% extends "base.html" %}

{% block extra_css %}
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    .searching-gif {
        width: 100px;
        height: 100px;
        margin-bottom: 20px;
        animation: spin 2s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .book-image {
        cursor: pointer;
        transition: transform 0.3s ease;
    }
    .book-image:hover {
        transform: scale(1.05);
    }
    #imageModal .modal-content {
        width: auto;
        max-width: 70%;
        background-color: transparent;
        border: none;
        box-shadow: none;
    }
    #imageModal img {
        max-width: none;
        height: 55vh;
        width: auto;
        object-fit: contain;
        box-shadow: 0 0 30px rgba(255,255,255,0.2);
    }
    #buyButton {
        margin-top: 20px;
        padding: 15px 30px;
        font-size: 1.4em;
        background-color: #4CAF50;
        border: none;
        color: white;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.3s;
    }
    #buyButton:hover {
        background-color: #45a049;
    }
    #searchArea {
        transition: all 0.3s ease-out;
    }
    #searchArea.shrink {
        transform: scale(0.8);
        opacity: 0.8;
    }
    #expandButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        display: none;
    }
    #visitorCounter {
        display: inline-block;
        margin-right: 10px;
        color: #6c757d;
    }
    .theme-visitor-container {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        align-items: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="theme-visitor-container">
    <span id="visitorCounter">Visitors: {{ visitor_count }}</span>
    <select id="themeSelector" class="form-select form-select-sm" style="width: auto;">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</div>
<div class="container mt-5">
    <div id="searchArea" class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <h1 class="text-center mb-4">Ross's Demo AI Book Search</h1>
            <form id="searchForm">
                <div class="mb-3">
                    <label for="authorInput" class="form-label">Author:</label>
                    <input type="text" class="form-control" id="authorInput" name="author" placeholder="Enter author name (optional)">
                </div>
                <div class="mb-3">
                    <label for="titleInput" class="form-label">Title Contains:</label>
                    <input type="text" class="form-control" id="titleInput" name="title" placeholder="Enter part of the title (optional)">
                </div>
                <div class="mb-3">
                    <label for="subjectInput" class="form-label">Subject:</label>
                    <input type="text" class="form-control" id="subjectInput" name="subject" placeholder="Enter subject (optional)">
                </div>
                <div class="text-center mt-3">
                    <button type="submit" id="searchButton" class="btn btn-primary">Search</button>
                </div>
            </form>
        </div>
    </div>
    <div id="results" class="mt-4"></div>
</div>

<button id="expandButton" class="btn btn-primary">
    <i class="fas fa-search"></i> New Search
</button>

<!-- Searching Modal -->
<div id="searchingModal" class="modal">
    <div class="modal-content">
        <img src="{{ url_for('static', filename='wait.gif') }}" alt="Searching..." class="searching-gif">
        <!-- Fallback SVG spinner -->
        <svg class="searching-gif" viewBox="0 0 50 50" style="display: none;">
            <circle cx="25" cy="25" r="20" fill="none" stroke="#000" stroke-width="5" />
        </svg>
        <p>Searching...</p>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="modal">
    <div class="modal-content">
        <img id="modalImage" src="" alt="Book Cover">
        <a id="buyButton" href="#" target="_blank" class="btn btn-primary btn-lg">Buy</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}